import{y as D,s as x,S as ue,i as ce,e as c,a as C,d as f,f as h,g as u,l as y,G as Z,H as q,w as Ie,t as L,r as G,h as V,I as Ge,c as se,q as $,m as ae,u as ee,v as te,j as oe,k as re,n as fe,x as de,b as le}from"./index.22c4bd04.js";import{N as Pe}from"./Nav.25ef4dbe.js";import"https://esm.run/localforage";import{NFTStorage as qe}from"https://cdn.jsdelivr.net/npm/nft.storage/dist/bundle.esm.min.js";import{r as H,a as He,g as ne}from"./db.6824b741.js";const E=[];function Ne(s,e=D){let t;const l=new Set;function i(r){if(x(s,r)&&(s=r,t)){const o=!E.length;for(const d of l)d[1](),E.push(d,s);if(o){for(let d=0;d<E.length;d+=2)E[d][0](E[d+1]);E.length=0}}}function n(r){i(r(s))}function a(r,o=D){const d=[r,o];return l.add(d),l.size===1&&(t=e(i)||D),r(s),()=>{l.delete(d),l.size===0&&t&&(t(),t=null)}}return{set:i,update:n,subscribe:a}}let O=Ne([]),J=Ne([]);function be(s,e,t){const l=s.slice();return l[5]=e[t],l}function ve(s,e,t){const l=s.slice();return l[5]=e[t],l}function Le(s){let e;return{c(){e=c("div"),e.textContent="empty",f(e,"class","empty svelte-3p4k7a")},m(t,l){h(t,e,l)},p:D,d(t){t&&y(e)}}}function je(s){let e,t=s[0],l=[];for(let i=0;i<t.length;i+=1)l[i]=ke(ve(s,t,i));return{c(){e=c("div");for(let i=0;i<l.length;i+=1)l[i].c();f(e,"class","info svelte-3p4k7a")},m(i,n){h(i,e,n);for(let a=0;a<l.length;a+=1)l[a]&&l[a].m(e,null)},p(i,n){if(n&5){t=i[0];let a;for(a=0;a<t.length;a+=1){const r=ve(i,t,a);l[a]?l[a].p(r,n):(l[a]=ke(r),l[a].c(),l[a].m(e,null))}for(;a<l.length;a+=1)l[a].d(1);l.length=t.length}},d(i){i&&y(e),Ie(l,i)}}}function ke(s){let e,t,l,i=s[5].name+"",n,a,r,o=s[5].cid+"",d,b,M,_,v,k,S;function g(){return s[3](s[5])}return{c(){e=c("div"),t=c("a"),l=c("h3"),n=L(i),a=C(),r=c("div"),d=L(o),M=C(),_=c("button"),_.innerHTML='<i class="fa-solid fa-trash-can"></i>',v=C(),f(t,"target","_blank"),f(t,"class","val svelte-3p4k7a"),f(t,"href",b="https://ipfs.io/ipfs/"+s[5].cid),f(_,"class","svelte-3p4k7a"),f(e,"class","item svelte-3p4k7a")},m(p,w){h(p,e,w),u(e,t),u(t,l),u(l,n),u(t,a),u(t,r),u(r,d),u(e,M),u(e,_),u(e,v),k||(S=G(_,"click",g),k=!0)},p(p,w){s=p,w&1&&i!==(i=s[5].name+"")&&V(n,i),w&1&&o!==(o=s[5].cid+"")&&V(d,o),w&1&&b!==(b="https://ipfs.io/ipfs/"+s[5].cid)&&f(t,"href",b)},d(p){p&&y(e),k=!1,S()}}}function ze(s){let e;return{c(){e=c("div"),e.textContent="empty",f(e,"class","empty svelte-3p4k7a")},m(t,l){h(t,e,l)},p:D,d(t){t&&y(e)}}}function Ae(s){let e,t=s[1],l=[];for(let i=0;i<t.length;i+=1)l[i]=he(be(s,t,i));return{c(){e=c("div");for(let i=0;i<l.length;i+=1)l[i].c();f(e,"class","info svelte-3p4k7a")},m(i,n){h(i,e,n);for(let a=0;a<l.length;a+=1)l[a]&&l[a].m(e,null)},p(i,n){if(n&6){t=i[1];let a;for(a=0;a<t.length;a+=1){const r=be(i,t,a);l[a]?l[a].p(r,n):(l[a]=he(r),l[a].c(),l[a].m(e,null))}for(;a<l.length;a+=1)l[a].d(1);l.length=t.length}},d(i){i&&y(e),Ie(l,i)}}}function he(s){let e,t,l,i=s[5].name+"",n,a,r,o=s[5].cid+"",d,b,M,_,v,k,S;function g(){return s[4](s[5])}return{c(){e=c("div"),t=c("a"),l=c("h3"),n=L(i),a=C(),r=c("div"),d=L(o),M=C(),_=c("button"),_.innerHTML='<i class="fa-solid fa-trash-can"></i>',v=C(),f(t,"target","_blank"),f(t,"class","val svelte-3p4k7a"),f(t,"href",b="https://ipfs.io/ipfs/"+s[5].cid),f(_,"class","svelte-3p4k7a"),f(e,"class","item svelte-3p4k7a")},m(p,w){h(p,e,w),u(e,t),u(t,l),u(l,n),u(t,a),u(t,r),u(r,d),u(e,M),u(e,_),u(e,v),k||(S=G(_,"click",g),k=!0)},p(p,w){s=p,w&2&&i!==(i=s[5].name+"")&&V(n,i),w&2&&o!==(o=s[5].cid+"")&&V(d,o),w&2&&b!==(b="https://ipfs.io/ipfs/"+s[5].cid)&&f(t,"href",b)},d(p){p&&y(e),k=!1,S()}}}function Ee(s){let e,t,l,i,n,a,r;function o(k,S){return k[0].length>0?je:Le}let d=o(s),b=d(s);function M(k,S){return k[1].length>0?Ae:ze}let _=M(s),v=_(s);return{c(){e=c("div"),t=c("h2"),t.textContent="Files",l=C(),b.c(),i=C(),n=c("div"),a=c("h2"),a.textContent="Metadata",r=C(),v.c(),f(t,"class","svelte-3p4k7a"),f(e,"class","tab svelte-3p4k7a"),f(a,"class","svelte-3p4k7a"),f(n,"class","tab svelte-3p4k7a")},m(k,S){h(k,e,S),u(e,t),u(e,l),b.m(e,null),h(k,i,S),h(k,n,S),u(n,a),u(n,r),v.m(n,null)},p(k,[S]){d===(d=o(k))&&b?b.p(k,S):(b.d(1),b=d(k),b&&(b.c(),b.m(e,null))),_===(_=M(k))&&v?v.p(k,S):(v.d(1),v=_(k),v&&(v.c(),v.m(n,null)))},i:D,o:D,d(k){k&&y(e),b.d(),k&&y(i),k&&y(n),v.d()}}}function Oe(s,e,t){let l,i;Z(s,O,o=>t(0,l=o)),Z(s,J,o=>t(1,i=o));const n=async(o,d)=>{await He(o,d),q(J,i=await H("metadata"),i),q(O,l=H("file"),l)},a=o=>{n("file",o.name)},r=o=>{n("metadata",o.name)};return H("metadata").then(o=>{q(J,i=o,i)}),H("file").then(o=>{q(O,l=o,l)}),[l,i,n,a,r]}class Je extends ue{constructor(e){super(),ce(this,e,Oe,Ee,x,{})}}function ye(s){let e,t,l,i;return{c(){e=c("div"),t=c("button"),t.textContent="+ Upload a folder",f(e,"class","top")},m(n,a){h(n,e,a),u(e,t),l||(i=G(t,"click",s[15]),l=!0)},p:D,d(n){n&&y(e),l=!1,i()}}}function we(s){let e,t,l,i,n,a,r,o,d,b,M,_,v,k,S,g=s[4]&&ge(s),p=s[0].length>0&&Fe(s),w=s[7]=="file"&&s[0].length>0&&Ce(s);return{c(){e=c("div"),t=c("label"),t.textContent="Select a folder",l=C(),i=c("input"),n=C(),a=c("div"),r=c("div"),o=L("or "),d=c("span"),d.textContent="save folder CIDs manually",b=C(),g&&g.c(),M=C(),_=c("div"),p&&p.c(),v=C(),w&&w.c(),f(t,"class","name svelte-tusrwo"),f(i,"type","file"),f(i,"webkitdirectory",""),i.multiple=!0,f(i,"class","svelte-tusrwo"),f(d,"class","clickable svelte-tusrwo"),f(a,"class","manual svelte-tusrwo"),f(e,"class","item svelte-tusrwo"),f(_,"class","item svelte-tusrwo")},m(N,B){h(N,e,B),u(e,t),u(e,l),u(e,i),u(e,n),u(e,a),u(a,r),u(r,o),u(r,d),u(a,b),g&&g.m(a,null),h(N,M,B),h(N,_,B),p&&p.m(_,null),u(_,v),w&&w.m(_,null),k||(S=[G(i,"change",s[22]),G(d,"click",s[16])],k=!0)},p(N,B){N[4]?g?g.p(N,B):(g=ge(N),g.c(),g.m(a,null)):g&&(g.d(1),g=null),N[0].length>0?p?p.p(N,B):(p=Fe(N),p.c(),p.m(_,v)):p&&(p.d(1),p=null),N[7]=="file"&&N[0].length>0?w?w.p(N,B):(w=Ce(N),w.c(),w.m(_,null)):w&&(w.d(1),w=null)},d(N){N&&y(e),g&&g.d(),N&&y(M),N&&y(_),p&&p.d(),w&&w.d(),k=!1,de(S)}}}function ge(s){let e,t,l,i,n;function a(d,b){return d[9]?Ke:Re}let r=a(s),o=r(s);return{c(){e=c("form"),t=c("input"),l=C(),o.c(),f(t,"type","text"),f(t,"placeholder","IPFS CID"),f(t,"class","svelte-tusrwo")},m(d,b){h(d,e,b),u(e,t),$(t,s[11].cid),u(e,l),o.m(e,null),i||(n=[G(t,"input",s[23]),G(e,"submit",ee(te(s[17])))],i=!0)},p(d,b){b&2048&&t.value!==d[11].cid&&$(t,d[11].cid),r!==(r=a(d))&&(o.d(1),o=r(d),o&&(o.c(),o.m(e,null)))},d(d){d&&y(e),o.d(),i=!1,de(n)}}}function Re(s){let e;return{c(){e=c("input"),f(e,"type","submit"),e.value="Save",f(e,"class","svelte-tusrwo")},m(t,l){h(t,e,l)},d(t){t&&y(e)}}}function Ke(s){let e;return{c(){e=c("div"),e.textContent="Saved the folder",f(e,"class","disabled btn svelte-tusrwo")},m(t,l){h(t,e,l)},d(t){t&&y(e)}}}function Fe(s){let e;function t(n,a){return n[10].upload?We:n[7]=="metadata"?Ve:Qe}let l=t(s),i=l(s);return{c(){i.c(),e=le()},m(n,a){i.m(n,a),h(n,e,a)},p(n,a){l===(l=t(n))&&i?i.p(n,a):(i.d(1),i=l(n),i&&(i.c(),i.m(e.parentNode,e)))},d(n){i.d(n),n&&y(e)}}}function Qe(s){let e;return{c(){e=c("input"),f(e,"type","submit"),e.value="Upload files to IPFS",f(e,"class","svelte-tusrwo")},m(t,l){h(t,e,l)},p:D,d(t){t&&y(e)}}}function Ve(s){let e;return{c(){e=c("input"),f(e,"type","submit"),e.value="Upload metadata to IPFS",f(e,"class","svelte-tusrwo")},m(t,l){h(t,e,l)},p:D,d(t){t&&y(e)}}}function We(s){let e;function t(n,a){return n[7]=="metadata"?Ye:Xe}let l=t(s),i=l(s);return{c(){i.c(),e=le()},m(n,a){i.m(n,a),h(n,e,a)},p(n,a){l!==(l=t(n))&&(i.d(1),i=l(n),i&&(i.c(),i.m(e.parentNode,e)))},d(n){i.d(n),n&&y(e)}}}function Xe(s){let e;return{c(){e=c("div"),e.textContent="Uploaded files",f(e,"class","disabled btn svelte-tusrwo")},m(t,l){h(t,e,l)},d(t){t&&y(e)}}}function Ye(s){let e;return{c(){e=c("div"),e.textContent="Uploaded metadata",f(e,"class","disabled btn svelte-tusrwo")},m(t,l){h(t,e,l)},d(t){t&&y(e)}}}function Ce(s){let e;function t(n,a){return n[2]?xe:n[1].length>0?$e:Ze}let l=t(s),i=l(s);return{c(){i.c(),e=le()},m(n,a){i.m(n,a),h(n,e,a)},p(n,a){l===(l=t(n))&&i?i.p(n,a):(i.d(1),i=l(n),i&&(i.c(),i.m(e.parentNode,e)))},d(n){i.d(n),n&&y(e)}}}function Ze(s){let e,t,l;return{c(){e=c("button"),e.textContent="Generate metadata"},m(i,n){h(i,e,n),t||(l=G(e,"click",ee(te(s[14]))),t=!0)},p:D,d(i){i&&y(e),t=!1,l()}}}function $e(s){let e,t,l=s[10].generateMeta&&Se();function i(r,o){return r[10].uploadMeta?tt:et}let n=i(s),a=n(s);return{c(){l&&l.c(),e=C(),a.c(),t=le()},m(r,o){l&&l.m(r,o),h(r,e,o),a.m(r,o),h(r,t,o)},p(r,o){r[10].generateMeta?l||(l=Se(),l.c(),l.m(e.parentNode,e)):l&&(l.d(1),l=null),n===(n=i(r))&&a?a.p(r,o):(a.d(1),a=n(r),a&&(a.c(),a.m(t.parentNode,t)))},d(r){l&&l.d(r),r&&y(e),a.d(r),r&&y(t)}}}function xe(s){let e,t,l,i,n,a;return{c(){e=c("div"),t=c("i"),l=c("br"),i=L("generating metadata ("),n=L(s[3]),a=L("..."),f(t,"class","fa-solid fa-circle-notch fa-spin"),f(e,"class","loading")},m(r,o){h(r,e,o),u(e,t),u(e,l),u(e,i),u(e,n),u(e,a)},p(r,o){o&8&&V(n,r[3])},d(r){r&&y(e)}}}function Se(s){let e;return{c(){e=c("div"),e.textContent="Generated metadata",f(e,"class","btn disabled svelte-tusrwo")},m(t,l){h(t,e,l)},d(t){t&&y(e)}}}function et(s){let e,t,l;return{c(){e=c("button"),e.textContent="Upload metadata to IPFS"},m(i,n){h(i,e,n),t||(l=G(e,"click",ee(te(s[13]))),t=!0)},p:D,d(i){i&&y(e),t=!1,l()}}}function tt(s){let e;return{c(){e=c("div"),e.textContent="Uploaded metadata",f(e,"class","btn disabled svelte-tusrwo")},m(t,l){h(t,e,l)},p:D,d(t){t&&y(e)}}}function Me(s){let e;return{c(){e=c("div"),e.innerHTML='<i class="fa-solid fa-circle-notch fa-spin"></i><br/>uploading to IPFS...',f(e,"class","loading")},m(t,l){h(t,e,l)},d(t){t&&y(e)}}}function lt(s){let e,t,l,i,n,a,r,o,d,b,M,_,v,k,S,g,p,w,N,B,W,A,R,j,P,z,K,Q,X,T=s[8]==="hidden"&&ye(s),F=s[7]&&s[6]&&s[6].length>0&&we(s),I=s[5]&&Me();return P=new Je({}),K=Ge(s[19][0]),{c(){T&&T.c(),e=C(),t=c("form"),l=c("div"),i=c("label"),i.textContent="Folder type",n=C(),a=c("div"),r=c("div"),o=c("input"),d=C(),b=c("label"),b.textContent="metadata",M=C(),_=c("div"),v=c("input"),k=C(),S=c("label"),S.textContent="file",g=C(),p=c("div"),w=c("label"),w.textContent="Folder name",N=C(),B=c("input"),W=C(),F&&F.c(),R=C(),I&&I.c(),j=C(),se(P.$$.fragment),f(i,"class","name svelte-tusrwo"),f(o,"type","radio"),f(o,"name","type"),o.__value="metadata",o.value=o.__value,f(o,"class","svelte-tusrwo"),f(b,"class","inline svelte-tusrwo"),f(b,"for","type"),f(v,"type","radio"),f(v,"name","type"),v.__value="file",v.value=v.__value,f(v,"class","svelte-tusrwo"),f(S,"for","type"),f(S,"class","inline svelte-tusrwo"),f(a,"class","folder-type svelte-tusrwo"),f(l,"class","item svelte-tusrwo"),f(w,"class","name svelte-tusrwo"),f(B,"type","text"),f(B,"placeholder","save the folder as (only stored locally in your browser)"),f(B,"class","svelte-tusrwo"),f(p,"class","item svelte-tusrwo"),f(t,"class",A="form "+s[8]+" svelte-tusrwo"),K.p(o,v)},m(m,U){T&&T.m(m,U),h(m,e,U),h(m,t,U),u(t,l),u(l,i),u(l,n),u(l,a),u(a,r),u(r,o),o.checked=o.__value===s[7],u(r,d),u(r,b),u(a,M),u(a,_),u(_,v),v.checked=v.__value===s[7],u(_,k),u(_,S),u(t,g),u(t,p),u(p,w),u(p,N),u(p,B),$(B,s[6]),u(t,W),F&&F.m(t,null),h(m,R,U),I&&I.m(m,U),h(m,j,U),ae(P,m,U),z=!0,Q||(X=[G(o,"change",s[18]),G(v,"change",s[20]),G(B,"input",s[21]),G(t,"submit",ee(te(s[24])))],Q=!0)},p(m,[U]){m[8]==="hidden"?T?T.p(m,U):(T=ye(m),T.c(),T.m(e.parentNode,e)):T&&(T.d(1),T=null),U&128&&(o.checked=o.__value===m[7]),U&128&&(v.checked=v.__value===m[7]),U&64&&B.value!==m[6]&&$(B,m[6]),m[7]&&m[6]&&m[6].length>0?F?F.p(m,U):(F=we(m),F.c(),F.m(t,null)):F&&(F.d(1),F=null),(!z||U&256&&A!==(A="form "+m[8]+" svelte-tusrwo"))&&f(t,"class",A),m[5]?I||(I=Me(),I.c(),I.m(j.parentNode,j)):I&&(I.d(1),I=null)},i(m){z||(oe(P.$$.fragment,m),z=!0)},o(m){re(P.$$.fragment,m),z=!1},d(m){T&&T.d(m),m&&y(e),m&&y(t),F&&F.d(),m&&y(R),I&&I.d(m),m&&y(j),fe(P,m),K.r(),Q=!1,de(X)}}}function it(s,e,t){let l,i;Z(s,J,F=>t(26,l=F)),Z(s,O,F=>t(27,i=F));let n=[],a=[],r,o,d,b=!1,M,_,v="hidden",k,S,g={upload:!1,uploadMeta:!1,generateMeta:!1},p={cid:""};const w=async(F,I,m)=>{if(F&&I&&I.length>0){let U=ne(F);if(await U.getItem(I))alert("folder name already exists");else{let Y=await ne("api_key").getItem("key");Y||(alert("NFT.STORAGE api key needed. Go to the config page and set it first"),location.href="/config/"),t(5,b=!0);const Ue=Y,me=new qe({token:Ue}),ie=await me.storeDirectory(m);console.log("cid",ie);const Be=await me.status(ie);console.log("status",Be),t(5,b=!1),await U.setItem(I,ie);let Te=await H("file");q(O,i=Te,i);let De=await H("metadata");q(J,l=De,l)}t(10,g.upload=!0,g)}else alert("the folder name and type should not be empty")},N=async()=>{await w("metadata",k,a),t(10,g.uploadMeta=!0,g)},B=async()=>{t(2,r=!0);let F=[];for(let I=0;I<n.length;I++){t(3,o=I+1);let U=await n[I].arrayBuffer();console.log("arrayBuf",U);let _e=await ipfsh.file(new Uint8Array(U)),pe={image:"ipfs://"+_e},Y=new File([JSON.stringify(pe)],`${I+1}.json`);F.push(Y)}t(1,a=F),k=M,console.log("metafiles",a),console.log("type",_),t(2,r=!1),t(10,g.generateMeta=!0,g)},W=()=>{t(8,v="")},A=()=>{t(4,d=!0)},R=async()=>{if(_&&M&&M.length>0&&p.cid.length>0){let F=ne(_);if(await F.getItem(M))alert("folder name already exists");else{await F.setItem(M,p.cid);let m=await H("file");q(O,i=m,i);let U=await H("metadata");q(J,l=U,l)}t(9,S=!0)}else error="The cid and the name should not be empty"},j=[[]];function P(){_=this.__value,t(7,_)}function z(){_=this.__value,t(7,_)}function K(){M=this.value,t(6,M)}function Q(){n=this.files,t(0,n)}function X(){p.cid=this.value,t(11,p)}return[n,a,r,o,d,b,M,_,v,S,g,p,w,N,B,W,A,R,P,j,z,K,Q,X,()=>{w(_,M,n)}]}class nt extends ue{constructor(e){super(),ce(this,e,it,lt,x,{})}}function st(s){let e,t,l,i;return e=new Pe({props:{files:"selected"}}),l=new nt({}),{c(){se(e.$$.fragment),t=C(),se(l.$$.fragment)},m(n,a){ae(e,n,a),h(n,t,a),ae(l,n,a),i=!0},p:D,i(n){i||(oe(e.$$.fragment,n),oe(l.$$.fragment,n),i=!0)},o(n){re(e.$$.fragment,n),re(l.$$.fragment,n),i=!1},d(n){fe(e,n),n&&y(t),fe(l,n)}}}class at extends ue{constructor(e){super(),ce(this,e,null,st,x,{})}}new at({target:document.getElementById("files")});
