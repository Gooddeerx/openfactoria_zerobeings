import{z as D,s as x,S as ue,i as ce,e as c,a as F,d as f,f as h,g as u,l as y,G as Z,H as q,t as O,q as G,h as V,x as Ie,u as $,v as ee,w as te,y as de,b as le,c as ne,m as ae,j as oe,k as re,n as fe}from"./index.ab445ea7.js";import{N as Ge}from"./Nav.5e984f86.js";import"https://esm.run/localforage";import{NFTStorage as Pe}from"https://cdn.jsdelivr.net/npm/nft.storage/dist/bundle.esm.min.js";import{r as H,a as qe,g as se}from"./db.6824b741.js";const E=[];function Ne(s,e=D){let t;const l=new Set;function i(r){if(x(s,r)&&(s=r,t)){const o=!E.length;for(const d of l)d[1](),E.push(d,s);if(o){for(let d=0;d<E.length;d+=2)E[d][0](E[d+1]);E.length=0}}}function n(r){i(r(s))}function a(r,o=D){const d=[r,o];return l.add(d),l.size===1&&(t=e(i)||D),r(s),()=>{l.delete(d),l.size===0&&(t(),t=null)}}return{set:i,update:n,subscribe:a}}let J=Ne([]),R=Ne([]);function be(s,e,t){const l=s.slice();return l[5]=e[t],l}function ve(s,e,t){const l=s.slice();return l[5]=e[t],l}function He(s){let e;return{c(){e=c("div"),e.textContent="empty",f(e,"class","empty svelte-3p4k7a")},m(t,l){h(t,e,l)},p:D,d(t){t&&y(e)}}}function Oe(s){let e,t=s[0],l=[];for(let i=0;i<t.length;i+=1)l[i]=ke(ve(s,t,i));return{c(){e=c("div");for(let i=0;i<l.length;i+=1)l[i].c();f(e,"class","info svelte-3p4k7a")},m(i,n){h(i,e,n);for(let a=0;a<l.length;a+=1)l[a].m(e,null)},p(i,n){if(n&5){t=i[0];let a;for(a=0;a<t.length;a+=1){const r=ve(i,t,a);l[a]?l[a].p(r,n):(l[a]=ke(r),l[a].c(),l[a].m(e,null))}for(;a<l.length;a+=1)l[a].d(1);l.length=t.length}},d(i){i&&y(e),Ie(l,i)}}}function ke(s){let e,t,l,i=s[5].name+"",n,a,r,o=s[5].cid+"",d,v,M,p,m,k,C;function g(){return s[3](s[5])}return{c(){e=c("div"),t=c("a"),l=c("h3"),n=O(i),a=F(),r=c("div"),d=O(o),M=F(),p=c("button"),p.innerHTML='<i class="fa-solid fa-trash-can"></i>',m=F(),f(t,"target","_blank"),f(t,"class","val svelte-3p4k7a"),f(t,"href",v="https://ipfs.io/ipfs/"+s[5].cid),f(p,"class","svelte-3p4k7a"),f(e,"class","item svelte-3p4k7a")},m(b,w){h(b,e,w),u(e,t),u(t,l),u(l,n),u(t,a),u(t,r),u(r,d),u(e,M),u(e,p),u(e,m),k||(C=G(p,"click",g),k=!0)},p(b,w){s=b,w&1&&i!==(i=s[5].name+"")&&V(n,i),w&1&&o!==(o=s[5].cid+"")&&V(d,o),w&1&&v!==(v="https://ipfs.io/ipfs/"+s[5].cid)&&f(t,"href",v)},d(b){b&&y(e),k=!1,C()}}}function ze(s){let e;return{c(){e=c("div"),e.textContent="empty",f(e,"class","empty svelte-3p4k7a")},m(t,l){h(t,e,l)},p:D,d(t){t&&y(e)}}}function Le(s){let e,t=s[1],l=[];for(let i=0;i<t.length;i+=1)l[i]=he(be(s,t,i));return{c(){e=c("div");for(let i=0;i<l.length;i+=1)l[i].c();f(e,"class","info svelte-3p4k7a")},m(i,n){h(i,e,n);for(let a=0;a<l.length;a+=1)l[a].m(e,null)},p(i,n){if(n&6){t=i[1];let a;for(a=0;a<t.length;a+=1){const r=be(i,t,a);l[a]?l[a].p(r,n):(l[a]=he(r),l[a].c(),l[a].m(e,null))}for(;a<l.length;a+=1)l[a].d(1);l.length=t.length}},d(i){i&&y(e),Ie(l,i)}}}function he(s){let e,t,l,i=s[5].name+"",n,a,r,o=s[5].cid+"",d,v,M,p,m,k,C;function g(){return s[4](s[5])}return{c(){e=c("div"),t=c("a"),l=c("h3"),n=O(i),a=F(),r=c("div"),d=O(o),M=F(),p=c("button"),p.innerHTML='<i class="fa-solid fa-trash-can"></i>',m=F(),f(t,"target","_blank"),f(t,"class","val svelte-3p4k7a"),f(t,"href",v="https://ipfs.io/ipfs/"+s[5].cid),f(p,"class","svelte-3p4k7a"),f(e,"class","item svelte-3p4k7a")},m(b,w){h(b,e,w),u(e,t),u(t,l),u(l,n),u(t,a),u(t,r),u(r,d),u(e,M),u(e,p),u(e,m),k||(C=G(p,"click",g),k=!0)},p(b,w){s=b,w&2&&i!==(i=s[5].name+"")&&V(n,i),w&2&&o!==(o=s[5].cid+"")&&V(d,o),w&2&&v!==(v="https://ipfs.io/ipfs/"+s[5].cid)&&f(t,"href",v)},d(b){b&&y(e),k=!1,C()}}}function je(s){let e,t,l,i,n,a,r;function o(k,C){return k[0].length>0?Oe:He}let d=o(s),v=d(s);function M(k,C){return k[1].length>0?Le:ze}let p=M(s),m=p(s);return{c(){e=c("div"),t=c("h2"),t.textContent="Files",l=F(),v.c(),i=F(),n=c("div"),a=c("h2"),a.textContent="Metadata",r=F(),m.c(),f(t,"class","svelte-3p4k7a"),f(e,"class","tab svelte-3p4k7a"),f(a,"class","svelte-3p4k7a"),f(n,"class","tab svelte-3p4k7a")},m(k,C){h(k,e,C),u(e,t),u(e,l),v.m(e,null),h(k,i,C),h(k,n,C),u(n,a),u(n,r),m.m(n,null)},p(k,[C]){d===(d=o(k))&&v?v.p(k,C):(v.d(1),v=d(k),v&&(v.c(),v.m(e,null))),p===(p=M(k))&&m?m.p(k,C):(m.d(1),m=p(k),m&&(m.c(),m.m(n,null)))},i:D,o:D,d(k){k&&y(e),v.d(),k&&y(i),k&&y(n),m.d()}}}function Ae(s,e,t){let l,i;Z(s,J,o=>t(0,l=o)),Z(s,R,o=>t(1,i=o));const n=async(o,d)=>{await qe(o,d),q(R,i=await H("metadata"),i),q(J,l=H("file"),l)},a=o=>{n("file",o.name)},r=o=>{n("metadata",o.name)};return H("metadata").then(o=>{q(R,i=o,i)}),H("file").then(o=>{q(J,l=o,l)}),[l,i,n,a,r]}class Ee extends ue{constructor(e){super(),ce(this,e,Ae,je,x,{})}}function ye(s){let e,t,l,i;return{c(){e=c("div"),t=c("button"),t.textContent="+ Upload a folder",f(e,"class","top")},m(n,a){h(n,e,a),u(e,t),l||(i=G(t,"click",s[15]),l=!0)},p:D,d(n){n&&y(e),l=!1,i()}}}function we(s){let e,t,l,i,n,a,r,o,d,v,M,p,m,k,C,g=s[4]&&ge(s),b=s[0].length>0&&Fe(s),w=s[7]=="file"&&s[0].length>0&&Ce(s);return{c(){e=c("div"),t=c("label"),t.textContent="Select a folder",l=F(),i=c("input"),n=F(),a=c("div"),r=c("div"),o=O("or "),d=c("span"),d.textContent="save folder CIDs manually",v=F(),g&&g.c(),M=F(),p=c("div"),b&&b.c(),m=F(),w&&w.c(),f(t,"class","name svelte-tusrwo"),f(i,"type","file"),f(i,"webkitdirectory",""),i.multiple=!0,f(i,"class","svelte-tusrwo"),f(d,"class","clickable svelte-tusrwo"),f(a,"class","manual svelte-tusrwo"),f(e,"class","item svelte-tusrwo"),f(p,"class","item svelte-tusrwo")},m(I,N){h(I,e,N),u(e,t),u(e,l),u(e,i),u(e,n),u(e,a),u(a,r),u(r,o),u(r,d),u(a,v),g&&g.m(a,null),h(I,M,N),h(I,p,N),b&&b.m(p,null),u(p,m),w&&w.m(p,null),k||(C=[G(i,"change",s[22]),G(d,"click",s[16])],k=!0)},p(I,N){I[4]?g?g.p(I,N):(g=ge(I),g.c(),g.m(a,null)):g&&(g.d(1),g=null),I[0].length>0?b?b.p(I,N):(b=Fe(I),b.c(),b.m(p,m)):b&&(b.d(1),b=null),I[7]=="file"&&I[0].length>0?w?w.p(I,N):(w=Ce(I),w.c(),w.m(p,null)):w&&(w.d(1),w=null)},d(I){I&&y(e),g&&g.d(),I&&y(M),I&&y(p),b&&b.d(),w&&w.d(),k=!1,de(C)}}}function ge(s){let e,t,l,i,n;function a(d,v){return d[9]?Re:Je}let r=a(s),o=r(s);return{c(){e=c("form"),t=c("input"),l=F(),o.c(),f(t,"type","text"),f(t,"placeholder","IPFS CID"),f(t,"class","svelte-tusrwo")},m(d,v){h(d,e,v),u(e,t),$(t,s[11].cid),u(e,l),o.m(e,null),i||(n=[G(t,"input",s[23]),G(e,"submit",ee(te(s[17])))],i=!0)},p(d,v){v&2048&&t.value!==d[11].cid&&$(t,d[11].cid),r!==(r=a(d))&&(o.d(1),o=r(d),o&&(o.c(),o.m(e,null)))},d(d){d&&y(e),o.d(),i=!1,de(n)}}}function Je(s){let e;return{c(){e=c("input"),f(e,"type","submit"),e.value="Save",f(e,"class","svelte-tusrwo")},m(t,l){h(t,e,l)},d(t){t&&y(e)}}}function Re(s){let e;return{c(){e=c("div"),e.textContent="Saved the folder",f(e,"class","disabled btn svelte-tusrwo")},m(t,l){h(t,e,l)},d(t){t&&y(e)}}}function Fe(s){let e;function t(n,a){return n[10].upload?Ve:n[7]=="metadata"?Qe:Ke}let l=t(s),i=l(s);return{c(){i.c(),e=le()},m(n,a){i.m(n,a),h(n,e,a)},p(n,a){l===(l=t(n))&&i?i.p(n,a):(i.d(1),i=l(n),i&&(i.c(),i.m(e.parentNode,e)))},d(n){i.d(n),n&&y(e)}}}function Ke(s){let e;return{c(){e=c("input"),f(e,"type","submit"),e.value="Upload files to IPFS",f(e,"class","svelte-tusrwo")},m(t,l){h(t,e,l)},p:D,d(t){t&&y(e)}}}function Qe(s){let e;return{c(){e=c("input"),f(e,"type","submit"),e.value="Upload metadata to IPFS",f(e,"class","svelte-tusrwo")},m(t,l){h(t,e,l)},p:D,d(t){t&&y(e)}}}function Ve(s){let e;function t(n,a){return n[7]=="metadata"?Xe:We}let l=t(s),i=l(s);return{c(){i.c(),e=le()},m(n,a){i.m(n,a),h(n,e,a)},p(n,a){l!==(l=t(n))&&(i.d(1),i=l(n),i&&(i.c(),i.m(e.parentNode,e)))},d(n){i.d(n),n&&y(e)}}}function We(s){let e;return{c(){e=c("div"),e.textContent="Uploaded files",f(e,"class","disabled btn svelte-tusrwo")},m(t,l){h(t,e,l)},d(t){t&&y(e)}}}function Xe(s){let e;return{c(){e=c("div"),e.textContent="Uploaded metadata",f(e,"class","disabled btn svelte-tusrwo")},m(t,l){h(t,e,l)},d(t){t&&y(e)}}}function Ce(s){let e;function t(n,a){return n[2]?$e:n[1].length>0?Ze:Ye}let l=t(s),i=l(s);return{c(){i.c(),e=le()},m(n,a){i.m(n,a),h(n,e,a)},p(n,a){l===(l=t(n))&&i?i.p(n,a):(i.d(1),i=l(n),i&&(i.c(),i.m(e.parentNode,e)))},d(n){i.d(n),n&&y(e)}}}function Ye(s){let e,t,l;return{c(){e=c("button"),e.textContent="Generate metadata"},m(i,n){h(i,e,n),t||(l=G(e,"click",ee(te(s[14]))),t=!0)},p:D,d(i){i&&y(e),t=!1,l()}}}function Ze(s){let e,t,l=s[10].generateMeta&&Se();function i(r,o){return r[10].uploadMeta?et:xe}let n=i(s),a=n(s);return{c(){l&&l.c(),e=F(),a.c(),t=le()},m(r,o){l&&l.m(r,o),h(r,e,o),a.m(r,o),h(r,t,o)},p(r,o){r[10].generateMeta?l||(l=Se(),l.c(),l.m(e.parentNode,e)):l&&(l.d(1),l=null),n===(n=i(r))&&a?a.p(r,o):(a.d(1),a=n(r),a&&(a.c(),a.m(t.parentNode,t)))},d(r){l&&l.d(r),r&&y(e),a.d(r),r&&y(t)}}}function $e(s){let e,t,l,i,n,a;return{c(){e=c("div"),t=c("i"),l=c("br"),i=O("generating metadata ("),n=O(s[3]),a=O("..."),f(t,"class","fa-solid fa-circle-notch fa-spin"),f(e,"class","loading")},m(r,o){h(r,e,o),u(e,t),u(e,l),u(e,i),u(e,n),u(e,a)},p(r,o){o&8&&V(n,r[3])},d(r){r&&y(e)}}}function Se(s){let e;return{c(){e=c("div"),e.textContent="Generated metadata",f(e,"class","btn disabled svelte-tusrwo")},m(t,l){h(t,e,l)},d(t){t&&y(e)}}}function xe(s){let e,t,l;return{c(){e=c("button"),e.textContent="Upload metadata to IPFS"},m(i,n){h(i,e,n),t||(l=G(e,"click",ee(te(s[13]))),t=!0)},p:D,d(i){i&&y(e),t=!1,l()}}}function et(s){let e;return{c(){e=c("div"),e.textContent="Uploaded metadata",f(e,"class","btn disabled svelte-tusrwo")},m(t,l){h(t,e,l)},p:D,d(t){t&&y(e)}}}function Me(s){let e;return{c(){e=c("div"),e.innerHTML='<i class="fa-solid fa-circle-notch fa-spin"></i><br/>uploading to IPFS...',f(e,"class","loading")},m(t,l){h(t,e,l)},d(t){t&&y(e)}}}function tt(s){let e,t,l,i,n,a,r,o,d,v,M,p,m,k,C,g,b,w,I,N,W,A,K,z,P,L,Q,X,B=s[8]==="hidden"&&ye(s),T=s[7]&&s[6]&&s[6].length>0&&we(s),S=s[5]&&Me();return P=new Ee({}),{c(){B&&B.c(),e=F(),t=c("form"),l=c("div"),i=c("label"),i.textContent="Folder type",n=F(),a=c("div"),r=c("div"),o=c("input"),d=F(),v=c("label"),v.textContent="metadata",M=F(),p=c("div"),m=c("input"),k=F(),C=c("label"),C.textContent="file",g=F(),b=c("div"),w=c("label"),w.textContent="Folder name",I=F(),N=c("input"),W=F(),T&&T.c(),K=F(),S&&S.c(),z=F(),ne(P.$$.fragment),f(i,"class","name svelte-tusrwo"),f(o,"type","radio"),f(o,"name","type"),o.__value="metadata",o.value=o.__value,f(o,"class","svelte-tusrwo"),s[19][0].push(o),f(v,"class","inline svelte-tusrwo"),f(v,"for","type"),f(m,"type","radio"),f(m,"name","type"),m.__value="file",m.value=m.__value,f(m,"class","svelte-tusrwo"),s[19][0].push(m),f(C,"for","type"),f(C,"class","inline svelte-tusrwo"),f(a,"class","folder-type svelte-tusrwo"),f(l,"class","item svelte-tusrwo"),f(w,"class","name svelte-tusrwo"),f(N,"type","text"),f(N,"placeholder","save the folder as (only stored locally in your browser)"),f(N,"class","svelte-tusrwo"),f(b,"class","item svelte-tusrwo"),f(t,"class",A="form "+s[8]+" svelte-tusrwo")},m(_,U){B&&B.m(_,U),h(_,e,U),h(_,t,U),u(t,l),u(l,i),u(l,n),u(l,a),u(a,r),u(r,o),o.checked=o.__value===s[7],u(r,d),u(r,v),u(a,M),u(a,p),u(p,m),m.checked=m.__value===s[7],u(p,k),u(p,C),u(t,g),u(t,b),u(b,w),u(b,I),u(b,N),$(N,s[6]),u(t,W),T&&T.m(t,null),h(_,K,U),S&&S.m(_,U),h(_,z,U),ae(P,_,U),L=!0,Q||(X=[G(o,"change",s[18]),G(m,"change",s[20]),G(N,"input",s[21]),G(t,"submit",ee(te(s[24])))],Q=!0)},p(_,[U]){_[8]==="hidden"?B?B.p(_,U):(B=ye(_),B.c(),B.m(e.parentNode,e)):B&&(B.d(1),B=null),U&128&&(o.checked=o.__value===_[7]),U&128&&(m.checked=m.__value===_[7]),U&64&&N.value!==_[6]&&$(N,_[6]),_[7]&&_[6]&&_[6].length>0?T?T.p(_,U):(T=we(_),T.c(),T.m(t,null)):T&&(T.d(1),T=null),(!L||U&256&&A!==(A="form "+_[8]+" svelte-tusrwo"))&&f(t,"class",A),_[5]?S||(S=Me(),S.c(),S.m(z.parentNode,z)):S&&(S.d(1),S=null)},i(_){L||(oe(P.$$.fragment,_),L=!0)},o(_){re(P.$$.fragment,_),L=!1},d(_){B&&B.d(_),_&&y(e),_&&y(t),s[19][0].splice(s[19][0].indexOf(o),1),s[19][0].splice(s[19][0].indexOf(m),1),T&&T.d(),_&&y(K),S&&S.d(_),_&&y(z),fe(P,_),Q=!1,de(X)}}}function lt(s,e,t){let l,i;Z(s,R,S=>t(26,l=S)),Z(s,J,S=>t(27,i=S));let n=[],a=[],r,o,d,v=!1,M,p,m="hidden",k,C,g={upload:!1,uploadMeta:!1,generateMeta:!1},b={cid:""};const w=async(S,_,U)=>{if(S&&_&&_.length>0){let j=se(S);if(await j.getItem(_))alert("folder name already exists");else{let Y=await se("api_key").getItem("key");Y||(alert("NFT.STORAGE api key needed. Go to the config page and set it first"),location.href="/config/"),t(5,v=!0);const Ue=Y,me=new Pe({token:Ue}),ie=await me.storeDirectory(U);console.log("cid",ie);const Be=await me.status(ie);console.log("status",Be),t(5,v=!1),await j.setItem(_,ie);let Te=await H("file");q(J,i=Te,i);let De=await H("metadata");q(R,l=De,l)}t(10,g.upload=!0,g)}else alert("the folder name and type should not be empty")},I=async()=>{await w("metadata",k,a),t(10,g.uploadMeta=!0,g)},N=async()=>{t(2,r=!0);let S=[];for(let _=0;_<n.length;_++){t(3,o=_+1);let j=await n[_].arrayBuffer();console.log("arrayBuf",j);let _e=await ipfsh.file(new Uint8Array(j)),pe={image:"ipfs://"+_e},Y=new File([JSON.stringify(pe)],`${_+1}.json`);S.push(Y)}t(1,a=S),k=M,console.log("metafiles",a),console.log("type",p),t(2,r=!1),t(10,g.generateMeta=!0,g)},W=()=>{t(8,m="")},A=()=>{t(4,d=!0)},K=async()=>{if(p&&M&&M.length>0&&b.cid.length>0){let S=se(p);if(await S.getItem(M))alert("folder name already exists");else{await S.setItem(M,b.cid);let U=await H("file");q(J,i=U,i);let j=await H("metadata");q(R,l=j,l)}t(9,C=!0)}else error="The cid and the name should not be empty"},z=[[]];function P(){p=this.__value,t(7,p)}function L(){p=this.__value,t(7,p)}function Q(){M=this.value,t(6,M)}function X(){n=this.files,t(0,n)}function B(){b.cid=this.value,t(11,b)}return[n,a,r,o,d,v,M,p,m,C,g,b,w,I,N,W,A,K,P,z,L,Q,X,B,()=>{w(p,M,n)}]}class it extends ue{constructor(e){super(),ce(this,e,lt,tt,x,{})}}function st(s){let e,t,l,i;return e=new Ge({props:{files:"selected"}}),l=new it({}),{c(){ne(e.$$.fragment),t=F(),ne(l.$$.fragment)},m(n,a){ae(e,n,a),h(n,t,a),ae(l,n,a),i=!0},p:D,i(n){i||(oe(e.$$.fragment,n),oe(l.$$.fragment,n),i=!0)},o(n){re(e.$$.fragment,n),re(l.$$.fragment,n),i=!1},d(n){fe(e,n),n&&y(t),fe(l,n)}}}class nt extends ue{constructor(e){super(),ce(this,e,null,st,x,{})}}new nt({target:document.getElementById("files")});
