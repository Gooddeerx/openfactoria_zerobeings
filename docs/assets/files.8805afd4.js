import{r as T,s as x,S as fe,i as re,e as c,d as u,f as g,t as K,a as h,g as f,h as Q,l as w,y as Fe,G as V,H as W,q as G,c as se,v as ce,m as ne,w as Ce,x as Se,j as ie,k as ae,n as oe,z as Ne,N as Be}from"./Nav.2716bc71.js";import"https://esm.run/localforage";import{NFTStorage as Ie}from"https://cdn.jsdelivr.net/npm/nft.storage/dist/bundle.esm.min.js";import{r as X,g as pe}from"./db.36f39b92.js";const E=[];function qe(i,l=T){let e;const t=new Set;function s(d){if(x(i,d)&&(i=d,e)){const o=!E.length;for(const r of t)r[1](),E.push(r,i);if(o){for(let r=0;r<E.length;r+=2)E[r][0](E[r+1]);E.length=0}}}function n(d){s(d(i))}function a(d,o=T){const r=[d,o];return t.add(r),t.size===1&&(e=l(s)||T),d(i),()=>{t.delete(r),t.size===0&&(e(),e=null)}}return{set:s,update:n,subscribe:a}}let Y=qe([]),Z=qe([]);function _e(i,l,e){const t=i.slice();return t[2]=l[e],t}function me(i,l,e){const t=i.slice();return t[2]=l[e],t}function ve(i){let l,e=i[0],t=[];for(let s=0;s<e.length;s+=1)t[s]=he(me(i,e,s));return{c(){l=c("div");for(let s=0;s<t.length;s+=1)t[s].c();u(l,"class","info svelte-4x5w4n")},m(s,n){g(s,l,n);for(let a=0;a<t.length;a+=1)t[a].m(l,null)},p(s,n){if(n&1){e=s[0];let a;for(a=0;a<e.length;a+=1){const d=me(s,e,a);t[a]?t[a].p(d,n):(t[a]=he(d),t[a].c(),t[a].m(l,null))}for(;a<t.length;a+=1)t[a].d(1);t.length=e.length}},d(s){s&&w(l),Fe(t,s)}}}function he(i){let l,e,t,s=i[2].name+"",n,a,d,o=i[2].cid+"",r,p,b;return{c(){l=c("div"),e=c("a"),t=c("h3"),n=K(s),a=h(),d=c("div"),r=K(o),b=h(),u(e,"target","_blank"),u(e,"class","val svelte-4x5w4n"),u(e,"href",p="https://ipfs.io/ipfs/"+i[2].cid),u(l,"class","item svelte-4x5w4n")},m(v,m){g(v,l,m),f(l,e),f(e,t),f(t,n),f(e,a),f(e,d),f(d,r),f(l,b)},p(v,m){m&1&&s!==(s=v[2].name+"")&&Q(n,s),m&1&&o!==(o=v[2].cid+"")&&Q(r,o),m&1&&p!==(p="https://ipfs.io/ipfs/"+v[2].cid)&&u(e,"href",p)},d(v){v&&w(l)}}}function be(i){let l,e=i[1],t=[];for(let s=0;s<e.length;s+=1)t[s]=ge(_e(i,e,s));return{c(){l=c("div");for(let s=0;s<t.length;s+=1)t[s].c();u(l,"class","info svelte-4x5w4n")},m(s,n){g(s,l,n);for(let a=0;a<t.length;a+=1)t[a].m(l,null)},p(s,n){if(n&2){e=s[1];let a;for(a=0;a<e.length;a+=1){const d=_e(s,e,a);t[a]?t[a].p(d,n):(t[a]=ge(d),t[a].c(),t[a].m(l,null))}for(;a<t.length;a+=1)t[a].d(1);t.length=e.length}},d(s){s&&w(l),Fe(t,s)}}}function ge(i){let l,e,t,s=i[2].name+"",n,a,d,o=i[2].cid+"",r,p,b;return{c(){l=c("div"),e=c("a"),t=c("h3"),n=K(s),a=h(),d=c("div"),r=K(o),b=h(),u(e,"target","_blank"),u(e,"class","val svelte-4x5w4n"),u(e,"href",p="https://ipfs.io/ipfs/"+i[2].cid),u(l,"class","item svelte-4x5w4n")},m(v,m){g(v,l,m),f(l,e),f(e,t),f(t,n),f(e,a),f(e,d),f(d,r),f(l,b)},p(v,m){m&2&&s!==(s=v[2].name+"")&&Q(n,s),m&2&&o!==(o=v[2].cid+"")&&Q(r,o),m&2&&p!==(p="https://ipfs.io/ipfs/"+v[2].cid)&&u(e,"href",p)},d(v){v&&w(l)}}}function $e(i){let l,e,t,s,n,a,d,o=i[0].length>0&&ve(i),r=i[1].length>0&&be(i);return{c(){l=c("div"),e=c("h2"),e.textContent="Files",t=h(),o&&o.c(),s=h(),n=c("div"),a=c("h2"),a.textContent="Metadata",d=h(),r&&r.c(),u(e,"class","svelte-4x5w4n"),u(l,"class","tab svelte-4x5w4n"),u(a,"class","svelte-4x5w4n"),u(n,"class","tab svelte-4x5w4n")},m(p,b){g(p,l,b),f(l,e),f(l,t),o&&o.m(l,null),g(p,s,b),g(p,n,b),f(n,a),f(n,d),r&&r.m(n,null)},p(p,[b]){p[0].length>0?o?o.p(p,b):(o=ve(p),o.c(),o.m(l,null)):o&&(o.d(1),o=null),p[1].length>0?r?r.p(p,b):(r=be(p),r.c(),r.m(n,null)):r&&(r.d(1),r=null)},i:T,o:T,d(p){p&&w(l),o&&o.d(),p&&w(s),p&&w(n),r&&r.d()}}}function Te(i,l,e){let t,s;return V(i,Y,n=>e(0,t=n)),V(i,Z,n=>e(1,s=n)),X("metadata").then(n=>{W(Z,s=n,s)}),X("file").then(n=>{W(Y,t=n,t)}),[t,s]}class ze extends fe{constructor(l){super(),re(this,l,Te,$e,x,{})}}function we(i){let l,e,t,s;return{c(){l=c("div"),e=c("button"),e.textContent="Upload",u(l,"class","top")},m(n,a){g(n,l,a),f(l,e),t||(s=G(e,"click",i[7]),t=!0)},p:T,d(n){n&&w(l),t=!1,s()}}}function ke(i){let l,e,t;return{c(){l=c("button"),l.textContent="Close"},m(s,n){g(s,l,n),e||(t=G(l,"click",i[6]),e=!0)},p:T,d(s){s&&w(l),e=!1,t()}}}function ye(i){let l;return{c(){l=c("div"),l.innerHTML='<i class="fa-solid fa-circle-notch fa-spin"></i><br/>uploading to IPFS...',u(l,"class","loading")},m(e,t){g(e,l,t)},d(e){e&&w(l)}}}function De(i){let l,e,t,s,n,a,d,o,r,p,b,v,m,A,z,L,B,C,ee,S,H,I,D,O,$,P,N,R,ue,J,te,M,U,j,le,de,k=i[4]==="hidden"&&we(i),y=i[4]===""&&ke(i),q=i[1]&&ye();return U=new ze({}),{c(){k&&k.c(),l=h(),e=c("form"),t=c("div"),s=c("label"),s.textContent="Folder type",n=h(),a=c("div"),d=c("div"),o=c("input"),r=h(),p=c("label"),p.textContent="metadata",b=h(),v=c("div"),m=c("input"),A=h(),z=c("label"),z.textContent="file",L=h(),B=c("div"),C=c("label"),C.textContent="Folder name",ee=h(),S=c("input"),H=h(),I=c("div"),D=c("label"),D.textContent="Select a folder",O=h(),$=c("input"),P=h(),N=c("div"),R=c("input"),ue=h(),y&&y.c(),te=h(),q&&q.c(),M=h(),se(U.$$.fragment),u(s,"class","name svelte-qwp9ds"),u(o,"type","radio"),u(o,"name","type"),o.__value="metadata",o.value=o.__value,i[9][0].push(o),u(p,"class","inline svelte-qwp9ds"),u(p,"for","type"),u(m,"type","radio"),u(m,"name","type"),m.__value="file",m.value=m.__value,i[9][0].push(m),u(z,"for","type"),u(z,"class","inline svelte-qwp9ds"),u(a,"class","folder-type svelte-qwp9ds"),u(t,"class","item"),u(C,"class","name svelte-qwp9ds"),u(S,"type","text"),u(S,"placeholder","save the folder as (only stored locally in your browser)"),u(B,"class","item"),u(D,"class","name svelte-qwp9ds"),u($,"type","file"),u($,"webkitdirectory",""),$.multiple=!0,u(I,"class","item"),u(R,"type","submit"),R.value="Save",u(N,"class","item"),u(e,"class",J="form "+i[4]+" svelte-qwp9ds")},m(_,F){k&&k.m(_,F),g(_,l,F),g(_,e,F),f(e,t),f(t,s),f(t,n),f(t,a),f(a,d),f(d,o),o.checked=o.__value===i[3],f(d,r),f(d,p),f(a,b),f(a,v),f(v,m),m.checked=m.__value===i[3],f(v,A),f(v,z),f(e,L),f(e,B),f(B,C),f(B,ee),f(B,S),ce(S,i[2]),f(e,H),f(e,I),f(I,D),f(I,O),f(I,$),f(e,P),f(e,N),f(N,R),f(N,ue),y&&y.m(N,null),g(_,te,F),q&&q.m(_,F),g(_,M,F),ne(U,_,F),j=!0,le||(de=[G(o,"change",i[8]),G(m,"change",i[10]),G(S,"input",i[11]),G($,"change",i[12]),G(e,"submit",Ce(Se(i[5])))],le=!0)},p(_,[F]){_[4]==="hidden"?k?k.p(_,F):(k=we(_),k.c(),k.m(l.parentNode,l)):k&&(k.d(1),k=null),F&8&&(o.checked=o.__value===_[3]),F&8&&(m.checked=m.__value===_[3]),F&4&&S.value!==_[2]&&ce(S,_[2]),_[4]===""?y?y.p(_,F):(y=ke(_),y.c(),y.m(N,null)):y&&(y.d(1),y=null),(!j||F&16&&J!==(J="form "+_[4]+" svelte-qwp9ds"))&&u(e,"class",J),_[1]?q||(q=ye(),q.c(),q.m(M.parentNode,M)):q&&(q.d(1),q=null)},i(_){j||(ie(U.$$.fragment,_),j=!0)},o(_){ae(U.$$.fragment,_),j=!1},d(_){k&&k.d(_),_&&w(l),_&&w(e),i[9][0].splice(i[9][0].indexOf(o),1),i[9][0].splice(i[9][0].indexOf(m),1),y&&y.d(),_&&w(te),q&&q.d(_),_&&w(M),oe(U,_),le=!1,Ne(de)}}}function Ge(i,l,e){let t,s;V(i,Z,C=>e(13,t=C)),V(i,Y,C=>e(14,s=C));let n=[],a=!1,d,o,r="hidden";const p=async()=>{if(o&&d&&d.length>0){let C=pe(o);if(await C.getItem(d))alert("folder name already exists");else{let H=await pe("api_key").getItem("key");H||(alert("NFT.STORAGE api key needed. Go to the config page and set it first"),location.href="/config/"),e(1,a=!0);const I=H,D=new Ie({token:I});console.log("files",n);const O=await D.storeDirectory(n);console.log("cid",O);const $=await D.status(O);console.log("status",$),e(1,a=!1),await C.setItem(d,O),e(2,d="");let P=await X("file");W(Y,s=P,s);let N=await X("metadata");W(Z,t=N,t),e(4,r="hidden")}}else alert("the folder name and type should not be empty")},b=()=>{e(4,r="hidden")},v=()=>{e(4,r="")},m=[[]];function A(){o=this.__value,e(3,o)}function z(){o=this.__value,e(3,o)}function L(){d=this.value,e(2,d)}function B(){n=this.files,e(0,n)}return[n,a,d,o,r,p,b,v,A,m,z,L,B]}class Oe extends fe{constructor(l){super(),re(this,l,Ge,De,x,{})}}function Ue(i){let l,e,t,s;return l=new Be({props:{files:"selected"}}),t=new Oe({}),{c(){se(l.$$.fragment),e=h(),se(t.$$.fragment)},m(n,a){ne(l,n,a),g(n,e,a),ne(t,n,a),s=!0},p:T,i(n){s||(ie(l.$$.fragment,n),ie(t.$$.fragment,n),s=!0)},o(n){ae(l.$$.fragment,n),ae(t.$$.fragment,n),s=!1},d(n){oe(l,n),n&&w(e),oe(t,n)}}}class Ee extends fe{constructor(l){super(),re(this,l,null,Ue,x,{})}}new Ee({target:document.getElementById("files")});
